--- flac-1.3.1/configure.ac~	2014-12-25 12:11:41.000000000 +0000
+++ flac-1.3.1/configure.ac	2014-12-25 12:28:28.561894846 +0000
@@ -105,6 +105,14 @@
 asm_optimisation=no
 case "$host_cpu" in
 	x86_64)
+		case "$host" in
+			*gnux32)
+				cpu_x86_64=true
+				AC_DEFINE(FLAC__CPU_X86_64)
+				AH_TEMPLATE(FLAC__CPU_X86_64, [define if building for x86_64])
+				asm_optimisation=$asm_opt
+				;;
+			*)
 		if test $ac_cv_sizeof_voidp = 4 ; then
 			# This must be a 32 bit user space running on 64 bit kernel so treat
 			# this as ia32.
@@ -118,6 +126,8 @@
 			AH_TEMPLATE(FLAC__CPU_X86_64, [define if building for x86_64])
 			fi
 		asm_optimisation=$asm_opt
+				;;
+		esac
 		;;
 	i*86)
 		cpu_ia32=true
@@ -150,6 +150,7 @@
 	*-*-cygwin|*mingw*) OBJ_FORMAT=win32 ;;
 	*-*-darwin*) OBJ_FORMAT=macho ;;
 	*emx*) OBJ_FORMAT=aout ;;
+	*gnux32*) OBJ_FORMAT=elfx32 ;;
 	*) OBJ_FORMAT=elf ;;
 esac
 AC_SUBST(OBJ_FORMAT)
@@ -370,6 +371,12 @@
 		CPPFLAGS="$CPPFLAGS -DFLAC__USE_VISIBILITY_ATTR"
 		CFLAGS="$CFLAGS -fvisibility=hidden"
 		CXXFLAGS="$CXXFLAGS -fvisibility=hidden"
+		fi
+
+	if test "$GCC_MAJOR_VERSION" -ge 4 && test "$OBJ_FORMAT" = elfx32; then
+		CPPFLAGS="$CPPFLAGS -DFLAC__USE_VISIBILITY_ATTR"
+		CFLAGS="$CFLAGS -fvisibility=hidden"
+		CXXFLAGS="$CXXFLAGS -fvisibility=hidden"
 		fi
 
 	if test "$GCC_MAJOR_VERSION" -ge 4 && test "$OBJ_FORMAT" = macho; then
--- flac-1.3.1/src/libFLAC/ia32/nasm.h~	2014-11-27 01:19:47.000000000 +0000
+++ flac-1.3.1/src/libFLAC/ia32/nasm.h	2014-12-25 12:31:46.790820947 +0000
@@ -50,6 +50,10 @@
 	%idefine code_section section .text align=16
 	%idefine data_section section .data align=32
 	%idefine bss_section  section .bss  align=32
+%elifdef OBJ_FORMAT_elfx32
+	%idefine code_section section .text align=16
+	%idefine data_section section .data align=32
+	%idefine bss_section  section .bss  align=32
 %else
 	%error unsupported object format!
 %endif
